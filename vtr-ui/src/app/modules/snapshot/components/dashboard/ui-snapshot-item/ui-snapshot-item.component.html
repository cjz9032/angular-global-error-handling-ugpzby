<div id="snapshot-item-{{ componentIndex }}" class="vtr-snapshot-list-item"
	[ngClass]="{'modified-module': component.info.IsDifferent}" >
	<div class="row">
		<div class="module-information" [ngClass]="{ 'last-child': isLastElement }">
			<div class="module-icon">
				<!-- Defines an icon according with component -->
				<img id="snapshot-item-{{ componentIndex }}-icon" *ngIf="getModuleIcon(name) !== ''"
					alt="{{ name }}"
					class="img-icon"
					[ngClass]="{'img-icon-disabled':getModuleIcon(name).indexOf('disabled')!==-1}"
					role="img"
					[src]="getModuleIcon(name) | svgInline | async" />
			</div>

			<!-- Icon to expand and collapse module information -->
			<div class="row" [ngClass]="{ 'component-disabled': component.status === snapshotStatus.noData }">
				<p id="snapshot-item-{{ componentIndex }}-module" role="text" class="title"
						*ngIf="!component.info.IsDifferent; else modifiedTitle">
					{{ 'snapshot.components.' + name | translate }}</p>

				<ng-template #modifiedTitle>
					<p id="snapshot-item-{{ componentIndex }}-module" role="text" class="title modified-item">
						* {{ 'snapshot.components.' + name | translate }}</p>
				</ng-template>
			</div>

			<!-- Shows load icon until modules are not loaded -->
			<img *ngIf="component.status !== snapshotStatus.hasData &&
						component.status !== snapshotStatus.noData; else updateButton"
				role="img" class="load-icon" [src]="'assets/icons/snapshot/icon_snapshot_progress.svg' | svgInline | async"/>

			<!-- Shows button to update after modules get loaded -->
			<ng-template #updateButton>
				<vtr-ui-hyperlink-button
					class="hyperlink-container update-btn"
					[metricsParent]="metricsParent"
					[metricsItem]="metricsItemName + '.Update'"
					linkId="snapshot-{{componentType}}-{{componentIndex}}-update-btn"
					hyperlinkStyle="xs-blue-lighter"
					[label]=" ('snapshot.snapshotUpdateButton' | translate).toUpperCase() "
					[isDisabled]="!isUpdateEnabled()"
					(hyperlinkClick)="updateSnapshot()"
					[tooltipText]="'snapshot.startComponentSnapshot' | translate: {'component':('snapshot.components.'+ name) | translate}">
				</vtr-ui-hyperlink-button>
			</ng-template>

			<!-- Icon to expand and collapse module information -->
			<div *ngIf="component.status !== snapshotStatus.noData; else hideDetailsInfo">
				<div id="snapshot-item-{{componentType}}-{{ componentIndex }}-details-btn"
					class="collapse-control"
					[attr.aria-label]="!detailsExpanded ? name + 'expand-module-details': name + 'collapse-module-details'"
					[attr.aria-expanded]="detailsExpanded"
					(click)="detailsExpanded = !detailsExpanded"
					(keyup.enter)="detailsExpanded = !detailsExpanded"
					tabindex="0"
					role="button">
					<fa-icon *ngIf="!detailsExpanded; else expandIcon" [icon]="['fal', 'angle-down']"></fa-icon>
					<ng-template #expandIcon>
						<fa-icon [icon]="['fal', 'angle-up']"></fa-icon>
					</ng-template>
				</div>
			</div>
			<ng-template #hideDetailsInfo>
				<div class="hide-details-info"></div>
			</ng-template>
		</div>
	</div>

	<!-- Table containing module information -->
	<div [ngbCollapse]="!detailsExpanded" class="details-list">
		<table id="snapshot-item-{{ componentIndex }}-details" class="table table-details table-borderless">
			<tbody>
				<tr *ngIf="component.status !== snapshotStatus.hasData; else moduleInfo">
					<td class="progress-warning-image">
						<fa-icon [icon]="['fal', 'circle-notch']" [spin]="true"></fa-icon>
					</td>
				</tr>
				<ng-template #moduleInfo>
					<tr>
						<td aria-hidden="true"></td>
						<th id="snapshot-item-{{ componentIndex }}-detail-baseline-snapshot-title" class="snapshot-table-titles">
							{{ 'snapshot.baselineSnapshot' | translate }}
						</th>
						<th id="snapshot-item-{{ componentIndex }}-detail-baseline-snapshot-title" class="snapshot-table-titles">
							{{ 'snapshot.lastSnapshot' | translate }}
						</th>
					</tr>

					<tr>
						<th id="snapshot-item-{{ componentIndex }}-detail-updated-date" class="table-info-name">
							{{ 'snapshot.properties.UpdatedDate' | translate }}
						</th>
						<td id="snapshot-item-{{ componentIndex }}-detail-update-date-base-value">
							<!-- Adding UTC string to ensure the correct date/time format -->
							{{ component.info.BaselineDate + ' UTC' | formatLocaleDateTime }}</td>
						<td id="snapshot-item-{{ componentIndex }}-detail-update-date-current-value" [ngClass]="{'modified-item': component.IsDifferent}">
							<!-- Adding UTC string to ensure the correct date/time format -->
							{{ component.info.LastSnapshotDate + ' UTC' | formatLocaleDateTime }}</td>
					</tr>

					<ng-template #recursiveList let-list>
						<ng-container *ngFor="let values of list; let i = index; let last = last;">
							<tr *ngFor="let property of values.Properties; let j = index">
								<th id="snapshot-item-{{ i }}-detail-{{ j }}-property-name" class="table-info-name">
									{{ 'snapshot.properties.' + property.PropertyName | translateDefault:property.PropertyName }}
								</th>
								<td id="snapshot-item-{{ i }}-detail-{{ j }}-base-value">
									{{ property.BaseValue }}</td>

								<td id="snapshot-item-{{ i }}-detail-{{ j }}-current-value" [ngClass]="{'modified-item': property.IsDifferent}">
									{{ property.CurrentValue }}</td>
							</tr>
							<ng-container *ngIf="array.isArray(values.SubDevices) && values.SubDevices.length > 0">
								<ng-container *ngTemplateOutlet="recursiveList; context:{ $implicit: values.SubDevices }"></ng-container>
							</ng-container>
							<tr *ngIf="!last" class="table-info-separator" aria-hidden="true"></tr>
						</ng-container>
					</ng-template>
					<ng-container *ngTemplateOutlet="recursiveList; context:{ $implicit: component.info.Items }"></ng-container>
				</ng-template>
				<tr class="table-info-separator" aria-hidden="true"></tr>
			</tbody>
		</table>
	</div>
</div>
